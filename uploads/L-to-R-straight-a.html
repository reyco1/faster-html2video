<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Ease Animation</title>
    
    <!-- EASEFORGE_PROJECT_METADATA
{
  "version": "1.0.0",
  "created": "2025-07-25T15:57:30.710Z",
  "application": "Custom Ease Tool",
  "points": [
    {
      "x": 59.199999999999996,
      "y": 212.66548672566373,
      "smooth": true,
      "handles": {
        "in": {
          "x": 19.199999999999992,
          "y": 217.96106194690262
        },
        "out": {
          "x": 184.39999999999998,
          "y": 203.26017699115042
        }
      }
    },
    {
      "x": 337.59999999999997,
      "y": 191.30973451327435,
      "smooth": true,
      "handles": {
        "in": {
          "x": 191.6,
          "y": 201.575221238938
        },
        "out": {
          "x": 400,
          "y": 180.55929203539824
        }
      }
    }
  ],
  "startAnchor": {
    "x": 0,
    "y": 397.6000239257798
  },
  "endAnchor": {
    "x": 400,
    "y": 0
  },
  "settings": {
    "animationDuration": 3,
    "isVerticalAnimation": false,
    "motionBlur": true,
    "maxBlur": 0.8,
    "previewMode": "box"
  },
  "ui": {
    "gridMode": "coarse",
    "snapToGrid": false,
    "darkMode": true
  },
  "scaleAnimation": {
    "enabled": true,
    "keyframes": [
      {
        "time": 0,
        "scale": 1
      },
      {
        "time": 1,
        "scale": 1.1
      }
    ]
  },
  "checksum": "4e3de6b5"
}
    -->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/CustomEase.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        #stage {
            width: 1920px;
            height: 1080px;
            position: relative;
            overflow: hidden;
            background: #000;
            border: 2px solid #333;
            margin: 0 auto;
        }
        

        .animation-container {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            width: 300%;
            height: 100%;
            display: flex;
            filter: blur(0px);
            will-change: filter, transform;
            transform: translate3d(0, -50%, 0);
            backface-visibility: hidden;
        }
        
        .animation-image {
            width: 33.333%;
            height: 100%;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            text-align: center;
            font-size: 18px;
            line-height: 1.5;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            max-width: 80%;
        }
        
        .instructions h2 {
            margin-top: 0;
            color: #3b82f6;
        }
        
        .instructions code {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #fbbf24;
        }
        
        .footer {
            margin-top: 20px;
            color: #666;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="stage" class="stage">
        <div class="instructions" id="instructions">
            <h2>Custom Ease Animation</h2>
            <p>To use this animation, add URL parameters:</p>
            <p><code>?image=YOUR_IMAGE_URL</code></p>
            <p><code>&duration=3</code> (optional)</p>
            <p><code>&blur=true</code> (optional)</p>
            <p><strong>Example:</strong></p>
            <p><code>animation.html?image=https://example.com/photo.jpg&duration=3&blur=true</code></p>
        </div>
    </div>
    
    <div class="footer">
        Generated by Custom Ease Tool
    </div>
    
    <script>
        gsap.registerPlugin(CustomEase);
        
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const imageUrl = urlParams.get('image') || 'https://rawshorts-media.s3.amazonaws.com/uploads/files/luis-sandbox/avion.jpg';
        const animationDuration = parseFloat(urlParams.get('duration')) || 3;
        const defaultMotionBlur = true;
        const enableMotionBlur = urlParams.has('blur') ? urlParams.get('blur') === 'true' : defaultMotionBlur;
        
        // Scale animation data
        const scaleAnimationEnabled = true;
        const scaleKeyframes = [{"time":0,"scale":1},{"time":1,"scale":1.1}];
        
        // Create custom ease
        const customEase = CustomEase.create("exported-ease", "M0,0.006 C0.049,0.158 0.048,0.455 0.148,0.468 C0.461,0.492 0.479,0.496 0.844,0.522 C1.000,0.549 0.949,0.842 1.000,1.050");
        
        // Debug motion blur setting with enhanced logging
        console.log('=== MOTION BLUR SETUP ===');
        console.log('Motion blur settings:', {
            defaultMotionBlur,
            enableMotionBlur,
            blurParam: urlParams.get('blur'),
            hasBlurParam: urlParams.has('blur'),
            imageUrl: imageUrl.substring(0, 50) + '...'
        });
        
        // Visual indicator for motion blur status
        if (enableMotionBlur) {
            console.log('ðŸŸ¢ MOTION BLUR ENABLED - You should see blur effects during animation');
        } else {
            console.log('ðŸ”´ MOTION BLUR DISABLED - No blur effects will be applied');
        }
        
        // Animation variables for motion blur
        let previousEaseValue = 0;
        let previousTime = 0;
        let isFirstFrame = true;
        
        function initializeVelocityTracking() {
            previousEaseValue = 0;
            previousTime = 0;
            isFirstFrame = true;
        }
        
        function updateDynamicBlur(progress, containerElement) {
            if (!enableMotionBlur || !containerElement) {
                if (!enableMotionBlur) console.log('Motion blur disabled');
                if (!containerElement) console.log('No container element');
                return;
            }
            
            const currentTime = performance.now();
            let currentEaseValue = 0;
            
            try {
                currentEaseValue = customEase(progress);
            } catch (e) {
                currentEaseValue = progress;
            }
            
            // Skip only the very first frame to establish baseline
            if (isFirstFrame) {
                previousEaseValue = currentEaseValue;
                previousTime = currentTime;
                isFirstFrame = false;
                // Apply minimal blur on first frame
                containerElement.style.filter = 'blur(0.5px)';
                return;
            }
            
            // Calculate velocity
            const deltaTime = (currentTime - previousTime) / 1000;
            const deltaValue = currentEaseValue - previousEaseValue;
            const velocity = deltaTime > 0 ? deltaValue / deltaTime : 0;
            
            // Apply blur based on velocity with increased sensitivity
            const rawBlurAmount = 8.0 * Math.abs(velocity);
            const maxBlur = 0.8;
            const blurAmount = Math.max(0.5, Math.min(maxBlur, rawBlurAmount));
            containerElement.style.filter = 'blur(' + blurAmount + 'px)';
            
            // Debug blur application  
            console.log('Motion blur applied:', {
                velocity: velocity.toFixed(3),
                rawBlur: rawBlurAmount.toFixed(2),
                finalBlur: blurAmount.toFixed(2) + 'px',
                progress: progress.toFixed(3)
            });
            
            // Store for next frame
            previousEaseValue = currentEaseValue;
            previousTime = currentTime;
        }
        
        function removeBlur(containerElement) {
            if (containerElement) {
                containerElement.style.filter = 'blur(0px)';
            }
        }
        
        // Scale animation functions
        function getScaleAtTime(time) {
            if (!scaleAnimationEnabled || !scaleKeyframes || scaleKeyframes.length === 0) {
                return 1.0;
            }
            
            // Clamp time to [0, 1]
            time = Math.max(0, Math.min(1, time));
            
            // Find surrounding keyframes
            let leftKeyframe = scaleKeyframes[0];
            let rightKeyframe = scaleKeyframes[scaleKeyframes.length - 1];
            
            for (let i = 0; i < scaleKeyframes.length - 1; i++) {
                if (time >= scaleKeyframes[i].time && time <= scaleKeyframes[i + 1].time) {
                    leftKeyframe = scaleKeyframes[i];
                    rightKeyframe = scaleKeyframes[i + 1];
                    break;
                }
            }
            
            // Linear interpolation between keyframes
            if (Math.abs(rightKeyframe.time - leftKeyframe.time) < 0.001) {
                return leftKeyframe.scale;
            }
            
            const t = (time - leftKeyframe.time) / (rightKeyframe.time - leftKeyframe.time);
            return leftKeyframe.scale + t * (rightKeyframe.scale - leftKeyframe.scale);
        }
        
        // Optimized scale transform function using GSAP for smooth performance
        let lastScaleValue;
        function updateScaleTransform(progress, containerElement) {
            if (!scaleAnimationEnabled || !containerElement) {
                return;
            }
            
            const scaleValue = getScaleAtTime(progress);
            
            // Skip update if scale hasn't changed significantly (performance optimization)
            if (lastScaleValue !== undefined && Math.abs(lastScaleValue - scaleValue) < 0.001) {
                return;
            }
            lastScaleValue = scaleValue;
            
            // Use GSAP.set to apply scale without interfering with position animation
            gsap.set(containerElement, { scale: scaleValue });
        }
        
        function startAnimation(containerElement) {
            console.log('ðŸš€ STARTING ANIMATION with motion blur:', enableMotionBlur, 'direction:', 'horizontal');
            initializeVelocityTracking();
            
            // Reset position based on direction
            
            gsap.set(containerElement, { x: 0 });
            
            // For horizontal: move by -66.666% of container width to show the animation effect
            const moveDistance = '-66.666%';
            
            // Start horizontal animation
            gsap.to(containerElement, {
                x: moveDistance,
                duration: animationDuration,
                ease: customEase,
                onUpdate: function() {
                    const progress = this.progress();
                    updateDynamicBlur(progress, containerElement);
                    updateScaleTransform(progress, containerElement);
                },
                onComplete: function() {
                    removeBlur(containerElement);
                }
            });
        }
        
        if (imageUrl && imageUrl !== '') {
            // Hide instructions
            document.getElementById('instructions').style.display = 'none';
            
            // Create container for the 3-image strip
            const container = document.createElement('div');
            container.className = 'animation-container';
            
            // Create three copies of the image for seamless animation effect
            let loadedCount = 0;
            const totalImages = 3;
            
            function onImageLoad() {
                loadedCount++;
                if (loadedCount === totalImages) {
                    // Start animation when all images are loaded
                    startAnimation(container);
                }
            }
            
            function onImageError() {
                document.getElementById('instructions').style.display = 'block';
                document.getElementById('instructions').innerHTML = 
                    '<h2>Image Load Error</h2><p>Could not load: <code>' + imageUrl + '</code></p><p>Please check the URL and try again.</p>';
            }
            
            // Create three identical images
            for (let i = 0; i < totalImages; i++) {
                const img = document.createElement('img');
                img.className = 'animation-image';
                img.onload = onImageLoad;
                img.onerror = onImageError;
                img.src = imageUrl;
                container.appendChild(img);
            }
            
            document.getElementById('stage').appendChild(container);
        }
    </script>
</body>
</html>